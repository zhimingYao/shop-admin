{"remainingRequest":"E:\\B-web\\02 第二阶段.听课记录\\06-23skr\\admin-shop\\node_modules\\babel-loader\\lib\\index.js!E:\\B-web\\02 第二阶段.听课记录\\06-23skr\\admin-shop\\node_modules\\eslint-loader\\index.js??ref--13-0!E:\\B-web\\02 第二阶段.听课记录\\06-23skr\\admin-shop\\src\\store\\modules\\permission.js","dependencies":[{"path":"E:\\B-web\\02 第二阶段.听课记录\\06-23skr\\admin-shop\\src\\store\\modules\\permission.js","mtime":1656728727280},{"path":"E:\\B-web\\02 第二阶段.听课记录\\06-23skr\\admin-shop\\babel.config.js","mtime":1656728727231},{"path":"E:\\B-web\\02 第二阶段.听课记录\\06-23skr\\admin-shop\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1656730876452},{"path":"E:\\B-web\\02 第二阶段.听课记录\\06-23skr\\admin-shop\\node_modules\\babel-loader\\lib\\index.js","mtime":1656730879893},{"path":"E:\\B-web\\02 第二阶段.听课记录\\06-23skr\\admin-shop\\node_modules\\eslint-loader\\index.js","mtime":1656730877210}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiRTovQi13ZWIvMDIgXHU3QjJDXHU0RThDXHU5NjM2XHU2QkI1Llx1NTQyQ1x1OEJGRVx1OEJCMFx1NUY1NS8wNi0yM3Nrci9hZG1pbi1zaG9wL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluY2x1ZGVzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdC5qcyI7CmltcG9ydCB7IGFzeW5jUm91dGVzLCBjb25zdGFudFJvdXRlcyB9IGZyb20gJ0Avcm91dGVyJzsKLyoqDQogKiBVc2UgbWV0YS5yb2xlIHRvIGRldGVybWluZSBpZiB0aGUgY3VycmVudCB1c2VyIGhhcyBwZXJtaXNzaW9uDQogKiBAcGFyYW0gcm9sZXMNCiAqIEBwYXJhbSByb3V0ZSANCiAqIA0KICog5Yik5pat6KeS6Imy5piv5ZCm5Y+v5Lul6K6/6Zeu6Lev55Sx77yb6L+U5Zue5YC8dHJ1Ze+8jOivtOaYjuWPr+S7peiuv+mXrg0KICAqLwoKZnVuY3Rpb24gaGFzUGVybWlzc2lvbihyb2xlcywgcm91dGUpIHsKICAvLyDot6/nlLHmnIltZXRh5bGe5oCn77yM5bm25LiUbWV0YeWxnuaAp+S4reWMheWQq3JvbGVz5a2X5q61CiAgaWYgKHJvdXRlLm1ldGEgJiYgcm91dGUubWV0YS5yb2xlcykgewogICAgLy8g5pWw57uEc29tZeaWueazle+8jOWIpOaWreaVsOe7hOS4reaYr+WQpuacieWFg+e0oOa7oei2s+adoeS7tu+8jOiHs+WwkeacieS4gOS4qua7oei2s+adoeS7tu+8jOWwsei/lOWbnnRydWXjgILot6/nlLHnmoRtZXRh5Litcm9sZXPkuK3mmK/lkKbljIXlkKvnlKjmiLfnmoTmn5DkuKrop5LoibI7CiAgICByZXR1cm4gcm9sZXMuc29tZShmdW5jdGlvbiAocm9sZSkgewogICAgICByZXR1cm4gcm91dGUubWV0YS5yb2xlcy5pbmNsdWRlcyhyb2xlKTsKICAgIH0pOwogIH0gZWxzZSB7CiAgICAvLyDot6/nlLHmnInmsqHmnIltZXRh5bGe5oCn77yM5oiW6ICFbWV0YeWxnuaAp+S4reayoeaciXJvbGVz5a2X5q61LOiupOS4uuaYr+WFrOWFsei3r+eUsTvkuIDlvovov5Tlm550cnVlCiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KLyoqDQogKiBGaWx0ZXIgYXN5bmNocm9ub3VzIHJvdXRpbmcgdGFibGVzIGJ5IHJlY3Vyc2lvbg0KICog6YCa6L+H6YCS5b2S77yM6L+H5ruk5byC5q2l6Lev55Sx5pWw57uEDQogKiBAcGFyYW0gcm91dGVzIGFzeW5jUm91dGVzDQogKiBAcGFyYW0gcm9sZXMNCiAqLwoKCmV4cG9ydCBmdW5jdGlvbiBmaWx0ZXJBc3luY1JvdXRlcyhyb3V0ZXMsIHJvbGVzKSB7CiAgLy8g5a6a5LmJ5pWw57uE5a2Y5pS+6L+H5ruk57uT5p6cCiAgdmFyIHJlcyA9IFtdOyAvLyBmb3JFYWNo6YGN5Y6G5pWw57uE77yM5Y+W5Ye65q+P5LiA5Liq6Lev55SxCgogIHJvdXRlcy5mb3JFYWNoKGZ1bmN0aW9uIChyb3V0ZSkgewogICAgdmFyIHRtcCA9IF9vYmplY3RTcHJlYWQoe30sIHJvdXRlKTsgLy8g5Yik5pat6L+Z5Liq6KeS6Imy5piv5ZCm5Y+v5Lul6K6/6Zeu6L+Z5Liq6Lev55SxCgoKICAgIGlmIChoYXNQZXJtaXNzaW9uKHJvbGVzLCB0bXApKSB7CiAgICAgIC8vIOivpeinkuiJsuWPr+S7peiuv+mXrui/meS4qui3r+eUsQogICAgICBpZiAodG1wLmNoaWxkcmVuKSB7CiAgICAgICAgLy/ot6/nlLHmnIljaGlsZHJlbuaXtjvpgJLlvZLosIPnlKjvvIzlr7ljaGlsZHJlbui/m+ihjOi/h+a7pAogICAgICAgIHRtcC5jaGlsZHJlbiA9IGZpbHRlckFzeW5jUm91dGVzKHRtcC5jaGlsZHJlbiwgcm9sZXMpOwogICAgICB9IC8v5bCG6Lev55Sx5re75Yqg5Yiw57uT5p6c5pWw57uE5LitIAoKCiAgICAgIHJlcy5wdXNoKHRtcCk7CiAgICB9CiAgfSk7CiAgcmV0dXJuIHJlczsKfQp2YXIgc3RhdGUgPSB7CiAgcm91dGVzOiBbXSwKICBhZGRSb3V0ZXM6IFtdCn07CnZhciBtdXRhdGlvbnMgPSB7CiAgU0VUX1JPVVRFUzogZnVuY3Rpb24gU0VUX1JPVVRFUyhzdGF0ZSwgcm91dGVzKSB7CiAgICAvLyBhZGRSb3V0ZXPvvJrln7rkuo7op5LoibLvvIzmt7vliqDnmoTot6/nlLHmlbDnu4QKICAgIHN0YXRlLmFkZFJvdXRlcyA9IHJvdXRlczsgLy/miYDmnInot6/nlLHmnoTmiJDnmoTmlbDnu4QKCiAgICBzdGF0ZS5yb3V0ZXMgPSBjb25zdGFudFJvdXRlcy5jb25jYXQocm91dGVzKTsKICB9Cn07CnZhciBhY3Rpb25zID0gewogIC8vIOeUn+aIkOi3r+eUsQogIGdlbmVyYXRlUm91dGVzOiBmdW5jdGlvbiBnZW5lcmF0ZVJvdXRlcyhfcmVmLCByb2xlcykgewogICAgdmFyIGNvbW1pdCA9IF9yZWYuY29tbWl0OwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgIC8vIAogICAgICB2YXIgYWNjZXNzZWRSb3V0ZXM7CgogICAgICBpZiAocm9sZXMuaW5jbHVkZXMoJ2FkbWluJykpIHsKICAgICAgICAvL+inkuiJsuS4reWMheWQq+euoeeQhuWRmDvku7vmhI/ot6/nlLHlnYflj6/orr/pl64KICAgICAgICBhY2Nlc3NlZFJvdXRlcyA9IGFzeW5jUm91dGVzIHx8IFtdOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIOinkuiJsuS4jeWMheWQq+euoeeQhuWRmDvln7rkuo7op5LoibLov4fmu6TlvILmraXot6/nlLHmlbDnu4Q7CiAgICAgICAgYWNjZXNzZWRSb3V0ZXMgPSBmaWx0ZXJBc3luY1JvdXRlcyhhc3luY1JvdXRlcywgcm9sZXMpOyAvLyByb2xlcz1bJ2VkaXRvciddCiAgICAgIH0gLy8g5pu05pawc3RvcmU75bCG57uT5p6c6Lev55Sx5pWw57uE5L+d5a2Y5Zyoc3RvcmXkuK3jgIIKCgogICAgICBjb21taXQoJ1NFVF9ST1VURVMnLCBhY2Nlc3NlZFJvdXRlcyk7IC8vIOS/ruaUueS7u+WKoeeKtuaAgeS4unJlc29sdmVkLOS/neWtmOS7u+WKoee7k+aenAoKICAgICAgcmVzb2x2ZShhY2Nlc3NlZFJvdXRlcyk7CiAgICB9KTsKICB9Cn07CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lc3BhY2VkOiB0cnVlLAogIHN0YXRlOiBzdGF0ZSwKICBtdXRhdGlvbnM6IG11dGF0aW9ucywKICBhY3Rpb25zOiBhY3Rpb25zCn07"},{"version":3,"names":["asyncRoutes","constantRoutes","hasPermission","roles","route","meta","some","role","includes","filterAsyncRoutes","routes","res","forEach","tmp","children","push","state","addRoutes","mutations","SET_ROUTES","concat","actions","generateRoutes","commit","Promise","resolve","accessedRoutes","namespaced"],"sources":["E:/B-web/02 第二阶段.听课记录/06-23skr/admin-shop/src/store/modules/permission.js"],"sourcesContent":["import { asyncRoutes, constantRoutes } from '@/router'\r\n\r\n/**\r\n * Use meta.role to determine if the current user has permission\r\n * @param roles\r\n * @param route \r\n * \r\n * 判断角色是否可以访问路由；返回值true，说明可以访问\r\n  */\r\nfunction hasPermission(roles, route) {\r\n  // 路由有meta属性，并且meta属性中包含roles字段\r\n  if (route.meta && route.meta.roles) {\r\n    // 数组some方法，判断数组中是否有元素满足条件，至少有一个满足条件，就返回true。路由的meta中roles中是否包含用户的某个角色;\r\n    return roles.some(role => route.meta.roles.includes(role));\r\n  } else {\r\n    // 路由有没有meta属性，或者meta属性中没有roles字段,认为是公共路由;一律返回true\r\n    return true\r\n  }\r\n}\r\n\r\n/**\r\n * Filter asynchronous routing tables by recursion\r\n * 通过递归，过滤异步路由数组\r\n * @param routes asyncRoutes\r\n * @param roles\r\n */\r\nexport function filterAsyncRoutes(routes, roles) {\r\n  // 定义数组存放过滤结果\r\n  const res = []\r\n  // forEach遍历数组，取出每一个路由\r\n  routes.forEach(route => {\r\n    const tmp = { ...route }\r\n    // 判断这个角色是否可以访问这个路由\r\n    if (hasPermission(roles, tmp)) {\r\n      // 该角色可以访问这个路由\r\n      if (tmp.children) {\r\n        //路由有children时;递归调用，对children进行过滤\r\n        tmp.children = filterAsyncRoutes(tmp.children, roles)\r\n      }\r\n      //将路由添加到结果数组中 \r\n      res.push(tmp)\r\n    }\r\n  })\r\n\r\n  return res\r\n}\r\n\r\nconst state = {\r\n  routes: [],\r\n  addRoutes: []\r\n}\r\n\r\nconst mutations = {\r\n  SET_ROUTES: (state, routes) => {\r\n    // addRoutes：基于角色，添加的路由数组\r\n    state.addRoutes = routes\r\n    //所有路由构成的数组\r\n    state.routes = constantRoutes.concat(routes)\r\n  }\r\n}\r\n\r\nconst actions = {\r\n  // 生成路由\r\n  generateRoutes({ commit }, roles) {\r\n    return new Promise(resolve => {\r\n      // \r\n      let accessedRoutes\r\n      if (roles.includes('admin')) {\r\n        //角色中包含管理员;任意路由均可访问\r\n        accessedRoutes = asyncRoutes || []\r\n      } else {\r\n        // 角色不包含管理员;基于角色过滤异步路由数组;\r\n        accessedRoutes = filterAsyncRoutes(asyncRoutes, roles) // roles=['editor']\r\n      }\r\n\r\n      // 更新store;将结果路由数组保存在store中。\r\n      commit('SET_ROUTES', accessedRoutes)\r\n      // 修改任务状态为resolved,保存任务结果\r\n      resolve(accessedRoutes);\r\n    })\r\n  }\r\n}\r\n\r\nexport default {\r\n  namespaced: true,\r\n  state,\r\n  mutations,\r\n  actions\r\n}\r\n"],"mappings":";;;;;;AAAA,SAASA,WAAT,EAAsBC,cAAtB,QAA4C,UAA5C;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,SAASC,aAAT,CAAuBC,KAAvB,EAA8BC,KAA9B,EAAqC;EACnC;EACA,IAAIA,KAAK,CAACC,IAAN,IAAcD,KAAK,CAACC,IAAN,CAAWF,KAA7B,EAAoC;IAClC;IACA,OAAOA,KAAK,CAACG,IAAN,CAAW,UAAAC,IAAI;MAAA,OAAIH,KAAK,CAACC,IAAN,CAAWF,KAAX,CAAiBK,QAAjB,CAA0BD,IAA1B,CAAJ;IAAA,CAAf,CAAP;EACD,CAHD,MAGO;IACL;IACA,OAAO,IAAP;EACD;AACF;AAED;AACA;AACA;AACA;AACA;AACA;;;AACA,OAAO,SAASE,iBAAT,CAA2BC,MAA3B,EAAmCP,KAAnC,EAA0C;EAC/C;EACA,IAAMQ,GAAG,GAAG,EAAZ,CAF+C,CAG/C;;EACAD,MAAM,CAACE,OAAP,CAAe,UAAAR,KAAK,EAAI;IACtB,IAAMS,GAAG,qBAAQT,KAAR,CAAT,CADsB,CAEtB;;;IACA,IAAIF,aAAa,CAACC,KAAD,EAAQU,GAAR,CAAjB,EAA+B;MAC7B;MACA,IAAIA,GAAG,CAACC,QAAR,EAAkB;QAChB;QACAD,GAAG,CAACC,QAAJ,GAAeL,iBAAiB,CAACI,GAAG,CAACC,QAAL,EAAeX,KAAf,CAAhC;MACD,CAL4B,CAM7B;;;MACAQ,GAAG,CAACI,IAAJ,CAASF,GAAT;IACD;EACF,CAZD;EAcA,OAAOF,GAAP;AACD;AAED,IAAMK,KAAK,GAAG;EACZN,MAAM,EAAE,EADI;EAEZO,SAAS,EAAE;AAFC,CAAd;AAKA,IAAMC,SAAS,GAAG;EAChBC,UAAU,EAAE,oBAACH,KAAD,EAAQN,MAAR,EAAmB;IAC7B;IACAM,KAAK,CAACC,SAAN,GAAkBP,MAAlB,CAF6B,CAG7B;;IACAM,KAAK,CAACN,MAAN,GAAeT,cAAc,CAACmB,MAAf,CAAsBV,MAAtB,CAAf;EACD;AANe,CAAlB;AASA,IAAMW,OAAO,GAAG;EACd;EACAC,cAFc,gCAEanB,KAFb,EAEoB;IAAA,IAAjBoB,MAAiB,QAAjBA,MAAiB;IAChC,OAAO,IAAIC,OAAJ,CAAY,UAAAC,OAAO,EAAI;MAC5B;MACA,IAAIC,cAAJ;;MACA,IAAIvB,KAAK,CAACK,QAAN,CAAe,OAAf,CAAJ,EAA6B;QAC3B;QACAkB,cAAc,GAAG1B,WAAW,IAAI,EAAhC;MACD,CAHD,MAGO;QACL;QACA0B,cAAc,GAAGjB,iBAAiB,CAACT,WAAD,EAAcG,KAAd,CAAlC,CAFK,CAEkD;MACxD,CAT2B,CAW5B;;;MACAoB,MAAM,CAAC,YAAD,EAAeG,cAAf,CAAN,CAZ4B,CAa5B;;MACAD,OAAO,CAACC,cAAD,CAAP;IACD,CAfM,CAAP;EAgBD;AAnBa,CAAhB;AAsBA,eAAe;EACbC,UAAU,EAAE,IADC;EAEbX,KAAK,EAALA,KAFa;EAGbE,SAAS,EAATA,SAHa;EAIbG,OAAO,EAAPA;AAJa,CAAf"}]}
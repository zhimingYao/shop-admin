{"remainingRequest":"E:\\B-web\\02 第二阶段.听课记录\\06-23skr\\admin-shop\\node_modules\\babel-loader\\lib\\index.js!E:\\B-web\\02 第二阶段.听课记录\\06-23skr\\admin-shop\\node_modules\\eslint-loader\\index.js??ref--13-0!E:\\B-web\\02 第二阶段.听课记录\\06-23skr\\admin-shop\\src\\permission.js","dependencies":[{"path":"E:\\B-web\\02 第二阶段.听课记录\\06-23skr\\admin-shop\\src\\permission.js","mtime":1656743889276},{"path":"E:\\B-web\\02 第二阶段.听课记录\\06-23skr\\admin-shop\\babel.config.js","mtime":1656728727231},{"path":"E:\\B-web\\02 第二阶段.听课记录\\06-23skr\\admin-shop\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1656730876452},{"path":"E:\\B-web\\02 第二阶段.听课记录\\06-23skr\\admin-shop\\node_modules\\babel-loader\\lib\\index.js","mtime":1656730879893},{"path":"E:\\B-web\\02 第二阶段.听课记录\\06-23skr\\admin-shop\\node_modules\\eslint-loader\\index.js","mtime":1656730877210}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9yZWdlbmVyYXRvclJ1bnRpbWUgZnJvbSAiRTovQi13ZWIvMDIgXHU3QjJDXHU0RThDXHU5NjM2XHU2QkI1Llx1NTQyQ1x1OEJGRVx1OEJCMFx1NUY1NS8wNi0yM3Nrci9hZG1pbi1zaG9wL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9yZWdlbmVyYXRvclJ1bnRpbWUuanMiOwppbXBvcnQgX29iamVjdFNwcmVhZCBmcm9tICJFOi9CLXdlYi8wMiBcdTdCMkNcdTRFOENcdTk2MzZcdTZCQjUuXHU1NDJDXHU4QkZFXHU4QkIwXHU1RjU1LzA2LTIzc2tyL2FkbWluLXNob3Avbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL29iamVjdFNwcmVhZDIuanMiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiRTovQi13ZWIvMDIgXHU3QjJDXHU0RThDXHU5NjM2XHU2QkI1Llx1NTQyQ1x1OEJGRVx1OEJCMFx1NUY1NS8wNi0yM3Nrci9hZG1pbi1zaG9wL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yLmpzIjsKaW1wb3J0IHJvdXRlciBmcm9tICcuL3JvdXRlcic7CmltcG9ydCBzdG9yZSBmcm9tICcuL3N0b3JlJzsKaW1wb3J0IHsgTWVzc2FnZSB9IGZyb20gJ2VsZW1lbnQtdWknOwppbXBvcnQgTlByb2dyZXNzIGZyb20gJ25wcm9ncmVzcyc7IC8vIHByb2dyZXNzIGJhcgoKaW1wb3J0ICducHJvZ3Jlc3MvbnByb2dyZXNzLmNzcyc7IC8vIHByb2dyZXNzIGJhciBzdHlsZQoKaW1wb3J0IHsgZ2V0VG9rZW4gfSBmcm9tICdAL3V0aWxzL2F1dGgnOyAvLyBnZXQgdG9rZW4gZnJvbSBjb29raWUKCmltcG9ydCBnZXRQYWdlVGl0bGUgZnJvbSAnQC91dGlscy9nZXQtcGFnZS10aXRsZSc7Ck5Qcm9ncmVzcy5jb25maWd1cmUoewogIHNob3dTcGlubmVyOiBmYWxzZQp9KTsgLy8gTlByb2dyZXNzIENvbmZpZ3VyYXRpb24KCnZhciB3aGl0ZUxpc3QgPSBbJy9sb2dpbiddOyAvLyBubyByZWRpcmVjdCB3aGl0ZWxpc3QKCnJvdXRlci5iZWZvcmVFYWNoKCAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIHZhciBfcmVmID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlKHRvLCBmcm9tLCBuZXh0KSB7CiAgICB2YXIgaGFzVG9rZW4sIGhhc1JvbGVzLCBfeWllbGQkc3RvcmUkZGlzcGF0Y2gsIHJvbGVzLCBhY2Nlc3NSb3V0ZXM7CgogICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAvLyBzdGFydCBwcm9ncmVzcyBiYXIKICAgICAgICAgICAgTlByb2dyZXNzLnN0YXJ0KCk7IC8vIHNldCBwYWdlIHRpdGxlCgogICAgICAgICAgICBkb2N1bWVudC50aXRsZSA9IGdldFBhZ2VUaXRsZSh0by5tZXRhLnRpdGxlKTsgLy/ojrflj5Z0b2tlbjvln7rkuo50b2tlbuaYr+WQpuWtmOWcqO+8jOWIpOaWreeUqOaIt+aYr+WQpueZu+W9le+8mwoKICAgICAgICAgICAgaGFzVG9rZW4gPSBnZXRUb2tlbigpOwoKICAgICAgICAgICAgaWYgKCFoYXNUb2tlbikgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzNTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCEodG8ucGF0aCA9PT0gJy9sb2dpbicpKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8v5bey57uP55m75b2V5LqG77yM5oOz5Y6755m75b2V6aG177yM6YeN5a6a5ZCR5Yiw6aaW6aG144CCCiAgICAgICAgICAgIG5leHQoewogICAgICAgICAgICAgIHBhdGg6ICcvJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgTlByb2dyZXNzLmRvbmUoKTsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDMzOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgIC8vIOW3sue7j+eZu+W9le+8jOS4lOiuv+mXrumdnueZu+W9lemhtemdogogICAgICAgICAgICAvLyBkZXRlcm1pbmUgd2hldGhlciB0aGUgdXNlciBoYXMgb2J0YWluZWQgaGlzIHBlcm1pc3Npb24gcm9sZXMgdGhyb3VnaCBnZXRJbmZvCiAgICAgICAgICAgIC8vIOWIpOaWrei/meS4queUqOaIt+eahOinkuiJsuaYr+WQpuWtmOWcqDsKICAgICAgICAgICAgaGFzUm9sZXMgPSBzdG9yZS5nZXR0ZXJzLnJvbGVzICYmIHN0b3JlLmdldHRlcnMucm9sZXMubGVuZ3RoID4gMDsKCiAgICAgICAgICAgIGlmICghaGFzUm9sZXMpIHsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG5leHQoKTsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDMzOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMTQ7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNzsKICAgICAgICAgICAgcmV0dXJuIHN0b3JlLmRpc3BhdGNoKCd1c2VyL2dldEluZm8nKTsKCiAgICAgICAgICBjYXNlIDE3OgogICAgICAgICAgICBfeWllbGQkc3RvcmUkZGlzcGF0Y2ggPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICByb2xlcyA9IF95aWVsZCRzdG9yZSRkaXNwYXRjaC5yb2xlczsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDIxOwogICAgICAgICAgICByZXR1cm4gc3RvcmUuZGlzcGF0Y2goJ3Blcm1pc3Npb24vZ2VuZXJhdGVSb3V0ZXMnLCByb2xlcyk7CgogICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgYWNjZXNzUm91dGVzID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coYWNjZXNzUm91dGVzKTsKICAgICAgICAgICAgLy/liqjmgIHmt7vliqDlj6/orr/pl67ot6/nlLEKICAgICAgICAgICAgcm91dGVyLmFkZFJvdXRlcyhhY2Nlc3NSb3V0ZXMpOyAvLyBoYWNrIG1ldGhvZCB0byBlbnN1cmUgdGhhdCBhZGRSb3V0ZXMgaXMgY29tcGxldGUKICAgICAgICAgICAgLy8gc2V0IHRoZSByZXBsYWNlOiB0cnVlLCBzbyB0aGUgbmF2aWdhdGlvbiB3aWxsIG5vdCBsZWF2ZSBhIGhpc3RvcnkgcmVjb3JkCgogICAgICAgICAgICBuZXh0KF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdG8pLCB7fSwgewogICAgICAgICAgICAgIHJlcGxhY2U6IHRydWUKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzM7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgMjY6CiAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAyNjsKICAgICAgICAgICAgX2NvbnRleHQudDAgPSBfY29udGV4dFsiY2F0Y2giXSgxNCk7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzMDsKICAgICAgICAgICAgcmV0dXJuIHN0b3JlLmRpc3BhdGNoKCd1c2VyL3Jlc2V0VG9rZW4nKTsKCiAgICAgICAgICBjYXNlIDMwOgogICAgICAgICAgICBNZXNzYWdlLmVycm9yKF9jb250ZXh0LnQwIHx8ICdIYXMgRXJyb3InKTsKICAgICAgICAgICAgbmV4dCgiL2xvZ2luP3JlZGlyZWN0PSIuY29uY2F0KHRvLnBhdGgpKTsKICAgICAgICAgICAgTlByb2dyZXNzLmRvbmUoKTsKCiAgICAgICAgICBjYXNlIDMzOgogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzY7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgMzU6CiAgICAgICAgICAgIC8qIGhhcyBubyB0b2tlbiovCiAgICAgICAgICAgIGlmICh3aGl0ZUxpc3QuaW5kZXhPZih0by5wYXRoKSAhPT0gLTEpIHsKICAgICAgICAgICAgICAvLyBpbiB0aGUgZnJlZSBsb2dpbiB3aGl0ZWxpc3QsIGdvIGRpcmVjdGx5CiAgICAgICAgICAgICAgbmV4dCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8vIG90aGVyIHBhZ2VzIHRoYXQgZG8gbm90IGhhdmUgcGVybWlzc2lvbiB0byBhY2Nlc3MgYXJlIHJlZGlyZWN0ZWQgdG8gdGhlIGxvZ2luIHBhZ2UuCiAgICAgICAgICAgICAgbmV4dCgiL2xvZ2luP3JlZGlyZWN0PSIuY29uY2F0KHRvLnBhdGgpKTsKICAgICAgICAgICAgICBOUHJvZ3Jlc3MuZG9uZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgY2FzZSAzNjoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlLCBudWxsLCBbWzE0LCAyNl1dKTsKICB9KSk7CgogIHJldHVybiBmdW5jdGlvbiAoX3gsIF94MiwgX3gzKSB7CiAgICByZXR1cm4gX3JlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07Cn0oKSk7CnJvdXRlci5hZnRlckVhY2goZnVuY3Rpb24gKCkgewogIC8vIGZpbmlzaCBwcm9ncmVzcyBiYXIKICBOUHJvZ3Jlc3MuZG9uZSgpOwp9KTs="},{"version":3,"names":["router","store","Message","NProgress","getToken","getPageTitle","configure","showSpinner","whiteList","beforeEach","to","from","next","start","document","title","meta","hasToken","path","done","hasRoles","getters","roles","length","dispatch","accessRoutes","addRoutes","replace","error","indexOf","afterEach"],"sources":["E:/B-web/02 第二阶段.听课记录/06-23skr/admin-shop/src/permission.js"],"sourcesContent":["import router from './router'\r\nimport store from './store'\r\nimport { Message } from 'element-ui'\r\nimport NProgress from 'nprogress' // progress bar\r\nimport 'nprogress/nprogress.css' // progress bar style\r\nimport { getToken } from '@/utils/auth' // get token from cookie\r\nimport getPageTitle from '@/utils/get-page-title'\r\n\r\nNProgress.configure({ showSpinner: false }) // NProgress Configuration\r\n\r\nconst whiteList = ['/login'] // no redirect whitelist\r\n\r\nrouter.beforeEach(async(to, from, next) => {\r\n  // start progress bar\r\n  NProgress.start()\r\n\r\n  // set page title\r\n  document.title = getPageTitle(to.meta.title)\r\n\r\n  //获取token;基于token是否存在，判断用户是否登录；\r\n  const hasToken = getToken()\r\n\r\n  if (hasToken) {\r\n    // 说明用户已经登录;\r\n    if (to.path === '/login') {\r\n      //已经登录了，想去登录页，重定向到首页。\r\n      next({ path: '/' })\r\n      NProgress.done()\r\n    } else {\r\n      // 已经登录，且访问非登录页面\r\n      // determine whether the user has obtained his permission roles through getInfo\r\n      // 判断这个用户的角色是否存在;\r\n      const hasRoles = store.getters.roles && store.getters.roles.length > 0\r\n      if (hasRoles) {\r\n        next();\r\n      } else {\r\n        // 角色信息数组为空；说明刚登录成功；\r\n        try {\r\n          // 获取用户的角色信息；\r\n          // es6的解构赋值、async\\await；store的模块化，命名空间。\r\n          const { roles } = await store.dispatch('user/getInfo');\r\n          // console.log(roles);\r\n\r\n          //基于角色生成可访问的路由映射。\r\n          const accessRoutes = await store.dispatch('permission/generateRoutes', roles);\r\n          // console.log(accessRoutes);\r\n\r\n          //动态添加可访问路由\r\n          router.addRoutes(accessRoutes)\r\n\r\n          // hack method to ensure that addRoutes is complete\r\n          // set the replace: true, so the navigation will not leave a history record\r\n          next({ ...to, replace: true })\r\n        } catch (error) {\r\n          // remove token and go to login page to re-login\r\n          await store.dispatch('user/resetToken')\r\n          Message.error(error || 'Has Error')\r\n          next(`/login?redirect=${to.path}`)\r\n          NProgress.done()\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    /* has no token*/\r\n\r\n    if (whiteList.indexOf(to.path) !== -1)\r\n     {\r\n      // in the free login whitelist, go directly\r\n      next()\r\n    } else {\r\n      // other pages that do not have permission to access are redirected to the login page.\r\n      next(`/login?redirect=${to.path}`)\r\n      NProgress.done()\r\n    }\r\n  }\r\n})\r\n\r\nrouter.afterEach(() => {\r\n  // finish progress bar\r\n  NProgress.done()\r\n})\r\n"],"mappings":";;;AAAA,OAAOA,MAAP,MAAmB,UAAnB;AACA,OAAOC,KAAP,MAAkB,SAAlB;AACA,SAASC,OAAT,QAAwB,YAAxB;AACA,OAAOC,SAAP,MAAsB,WAAtB,C,CAAkC;;AAClC,OAAO,yBAAP,C,CAAiC;;AACjC,SAASC,QAAT,QAAyB,cAAzB,C,CAAwC;;AACxC,OAAOC,YAAP,MAAyB,wBAAzB;AAEAF,SAAS,CAACG,SAAV,CAAoB;EAAEC,WAAW,EAAE;AAAf,CAApB,E,CAA4C;;AAE5C,IAAMC,SAAS,GAAG,CAAC,QAAD,CAAlB,C,CAA6B;;AAE7BR,MAAM,CAACS,UAAP;EAAA,sEAAkB,iBAAMC,EAAN,EAAUC,IAAV,EAAgBC,IAAhB;IAAA;;IAAA;MAAA;QAAA;UAAA;YAChB;YACAT,SAAS,CAACU,KAAV,GAFgB,CAIhB;;YACAC,QAAQ,CAACC,KAAT,GAAiBV,YAAY,CAACK,EAAE,CAACM,IAAH,CAAQD,KAAT,CAA7B,CALgB,CAOhB;;YACME,QARU,GAQCb,QAAQ,EART;;YAAA,KAUZa,QAVY;cAAA;cAAA;YAAA;;YAAA,MAYVP,EAAE,CAACQ,IAAH,KAAY,QAZF;cAAA;cAAA;YAAA;;YAaZ;YACAN,IAAI,CAAC;cAAEM,IAAI,EAAE;YAAR,CAAD,CAAJ;YACAf,SAAS,CAACgB,IAAV;YAfY;YAAA;;UAAA;YAiBZ;YACA;YACA;YACMC,QApBM,GAoBKnB,KAAK,CAACoB,OAAN,CAAcC,KAAd,IAAuBrB,KAAK,CAACoB,OAAN,CAAcC,KAAd,CAAoBC,MAApB,GAA6B,CApBzD;;YAAA,KAqBRH,QArBQ;cAAA;cAAA;YAAA;;YAsBVR,IAAI;YAtBM;YAAA;;UAAA;YAAA;YAAA;YAAA,OA4BgBX,KAAK,CAACuB,QAAN,CAAe,cAAf,CA5BhB;;UAAA;YAAA;YA4BAF,KA5BA,yBA4BAA,KA5BA;YAAA;YAAA,OAgCmBrB,KAAK,CAACuB,QAAN,CAAe,2BAAf,EAA4CF,KAA5C,CAhCnB;;UAAA;YAgCFG,YAhCE;YAiCR;YAEA;YACAzB,MAAM,CAAC0B,SAAP,CAAiBD,YAAjB,EApCQ,CAsCR;YACA;;YACAb,IAAI,iCAAMF,EAAN;cAAUiB,OAAO,EAAE;YAAnB,GAAJ;YAxCQ;YAAA;;UAAA;YAAA;YAAA;YAAA;YAAA,OA2CF1B,KAAK,CAACuB,QAAN,CAAe,iBAAf,CA3CE;;UAAA;YA4CRtB,OAAO,CAAC0B,KAAR,CAAc,eAAS,WAAvB;YACAhB,IAAI,2BAAoBF,EAAE,CAACQ,IAAvB,EAAJ;YACAf,SAAS,CAACgB,IAAV;;UA9CQ;YAAA;YAAA;;UAAA;YAmDd;YAEA,IAAIX,SAAS,CAACqB,OAAV,CAAkBnB,EAAE,CAACQ,IAArB,MAA+B,CAAC,CAApC,EACC;cACC;cACAN,IAAI;YACL,CAJD,MAIO;cACL;cACAA,IAAI,2BAAoBF,EAAE,CAACQ,IAAvB,EAAJ;cACAf,SAAS,CAACgB,IAAV;YACD;;UA7Da;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CAAlB;;EAAA;IAAA;EAAA;AAAA;AAiEAnB,MAAM,CAAC8B,SAAP,CAAiB,YAAM;EACrB;EACA3B,SAAS,CAACgB,IAAV;AACD,CAHD"}]}